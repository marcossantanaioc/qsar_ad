---

title: Load data


keywords: fastai
sidebar: home_sidebar



nb_path: "AD.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: AD.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/anaconda3/lib/python3.8/site-packages/statsmodels/tsa/base/tsa_model.py:7: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import (to_datetime, Int64Index, DatetimeIndex, Period,
/opt/anaconda3/lib/python3.8/site-packages/statsmodels/tsa/base/tsa_model.py:7: FutureWarning: pandas.Float64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import (to_datetime, Int64Index, DatetimeIndex, Period,
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span> -a &#39;Marcos Santana&#39; -d -p sophosdata,numpy,pandas,descriptastorus,joblib,rdkit,tqdm,fastcore -v
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:root:No normalization for BCUT2D_MWHI
WARNING:root:No normalization for BCUT2D_MWLOW
WARNING:root:No normalization for BCUT2D_CHGHI
WARNING:root:No normalization for BCUT2D_CHGLO
WARNING:root:No normalization for BCUT2D_LOGPHI
WARNING:root:No normalization for BCUT2D_LOGPLOW
WARNING:root:No normalization for BCUT2D_MRHI
WARNING:root:No normalization for BCUT2D_MRLOW
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Author: Marcos Santana

Python implementation: CPython
Python version       : 3.8.8
IPython version      : 7.22.0

sophosdata     : 1.3
numpy          : 1.20.1
pandas         : 1.1.3
descriptastorus: 2.3.0.5
joblib         : 0.17.0
rdkit          : 2022.03.1
tqdm           : 4.59.0
fastcore       : 1.4.2

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">Draw</span>
<span class="kn">import</span> <span class="nn">mols2grid</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">sophosdata.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[13:18:05] Initializing Normalizer
/opt/anaconda3/lib/python3.8/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  from pandas import MultiIndex, Int64Index
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Pf-PHEN_23_05_22_processed_dev_pIC50_5_classification_2022-05-23_trainset.csv&#39;</span><span class="p">)</span>
<span class="n">testset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Pf-PHEN_23_05_22_processed_dev_pIC50_5_classification_2022-05-23_testset.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainset</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">testset</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Featurize">Featurize<a class="anchor-link" href="#Featurize"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fingerprinter</span> <span class="o">=</span> <span class="n">Fingerprinter</span><span class="p">(</span><span class="s1">&#39;ecfp&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Xtrain</span> <span class="o">=</span> <span class="n">fingerprinter</span><span class="o">.</span><span class="n">generate_features</span><span class="p">(</span><span class="n">trainset</span><span class="p">[</span><span class="s1">&#39;processed_smiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">Xtest</span> <span class="o">=</span> <span class="n">fingerprinter</span><span class="o">.</span><span class="n">generate_features</span><span class="p">(</span><span class="n">testset</span><span class="p">[</span><span class="s1">&#39;processed_smiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">X_sample</span> <span class="o">=</span> <span class="n">Xtest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Applicability-domain">Applicability domain<a class="anchor-link" href="#Applicability-domain"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="K-nearest-neighbours-(Z-kNN)">K-nearest neighbours (Z-kNN)<a class="anchor-link" href="#K-nearest-neighbours-(Z-kNN)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>AD threshold</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calculate_similarity_from_array</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="n">fp2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Calculates a squared similarity matrix between two arrays of fingerprints</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    fp1 : numpy.array</span>
<span class="sd">        An array of fingerprints.</span>
<span class="sd">        </span>
<span class="sd">    fp2 : numpy.array</span>
<span class="sd">        Second array of fingerprints. If None, defaults to `fp1`.</span>
<span class="sd">        </span>
<span class="sd">    metric : str or callable, optional</span>
<span class="sd">        The distance metric to use. </span>
<span class="sd">        If a string, the distance function can be ‘braycurtis’, ‘canberra’, ‘chebyshev’,</span>
<span class="sd">        ‘cityblock’, ‘correlation’, ‘cosine’, ‘dice’, ‘euclidean’, ‘hamming’, ‘jaccard’,</span>
<span class="sd">        ‘jensenshannon’, ‘kulsinski’, ‘kulczynski1’, ‘mahalanobis’, ‘matching’, ‘minkowski’,</span>
<span class="sd">        ‘rogerstanimoto’, ‘russellrao’, ‘seuclidean’, ‘sokalmichener’, ‘sokalsneath’, ‘sqeuclidean’, ‘yule’.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    z : float</span>
<span class="sd">        Significance threshold. See original publication for more details: https://pubs.acs.org/doi/10.1021/ci060132x</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    simi_matrix : numpy.array</span>
<span class="sd">        A matrix with pairwise distance.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>
    <span class="k">if</span> <span class="n">fp2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">simi_matrix</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="n">fp1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">simi_matrix</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="n">fp2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">simi_matrix</span>

<span class="k">def</span> <span class="nf">calculate_ad_threhold</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        
    <span class="sd">&quot;&quot;&quot;Calculates the applicability domain threhold using k-NN method</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    X : numpy.array</span>
<span class="sd">        An array of fingerprints.</span>
<span class="sd">       </span>
<span class="sd">    metric : str or callable, optional</span>
<span class="sd">        The distance metric to use. </span>
<span class="sd">        If a string, the distance function can be ‘braycurtis’, ‘canberra’, ‘chebyshev’,</span>
<span class="sd">        ‘cityblock’, ‘correlation’, ‘cosine’, ‘dice’, ‘euclidean’, ‘hamming’, ‘jaccard’,</span>
<span class="sd">        ‘jensenshannon’, ‘kulsinski’, ‘kulczynski1’, ‘mahalanobis’, ‘matching’, ‘minkowski’,</span>
<span class="sd">        ‘rogerstanimoto’, ‘russellrao’, ‘seuclidean’, ‘sokalmichener’, ‘sokalsneath’, ‘sqeuclidean’, ‘yule’.</span>
<span class="sd">              </span>
<span class="sd">    z : float</span>
<span class="sd">        Significance threshold. See original publication for more details: https://pubs.acs.org/doi/10.1021/ci060132x</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    ad_threshold : float</span>
<span class="sd">        The distance threshold used to define the applicability domain.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>    
    <span class="n">simi_matrix</span> <span class="o">=</span> <span class="n">calculate_similarity_from_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="n">std_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">simi_matrix</span><span class="p">)</span> <span class="c1"># std of distances</span>
    <span class="n">avg_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simi_matrix</span><span class="p">)</span> <span class="c1"># average of distances</span>

    <span class="c1"># Applicability threhold</span>
    <span class="n">ad_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">std_distances</span><span class="p">)</span> <span class="o">+</span> <span class="n">avg_distances</span>
    <span class="k">return</span> <span class="n">ad_threshold</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#ad_threhold</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-k-nearest-neighbours"><strong>Get k-nearest neighbours</strong><a class="anchor-link" href="#Get-k-nearest-neighbours"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_knn</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">ref_fps</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Get the k-nearest neighbours and calculate the distance between fp and ref_fps.</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    fp : numpy.array</span>
<span class="sd">        Query fingerprint</span>
<span class="sd">        </span>
<span class="sd">    ref_fps : numpy.array</span>
<span class="sd">        Reference fingerprints</span>
<span class="sd">        </span>
<span class="sd">    k : int</span>
<span class="sd">        Number of k nearest neighbours</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    distances : numpy.array</span>
<span class="sd">        A matrix with pairwise distance.</span>
<span class="sd">        </span>
<span class="sd">    neighbours : numpy.array</span>
<span class="sd">        Index of k-nearest neighbours</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Generate similarity matrix</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">calculate_similarity_from_array</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">ref_fps</span><span class="p">)</span>
    <span class="c1"># Get kNN</span>
    <span class="n">neighbours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">distances</span><span class="p">)[:</span> <span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">neighbours</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-AD"><strong>Calculate AD</strong><a class="anchor-link" href="#Calculate-AD"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calculate_applicability_domain</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">ref_fp</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    
        
    <span class="sd">&quot;&quot;&quot;Get the k-nearest neighbours and calculate the distance between fp and ref_fps.</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    fp : numpy.array</span>
<span class="sd">        Query fingerprint</span>
<span class="sd">        </span>
<span class="sd">    ref_fps : numpy.array</span>
<span class="sd">        Reference fingerprints</span>
<span class="sd">        </span>
<span class="sd">    z : float</span>
<span class="sd">        Significance threshold. See original publication for more details: https://pubs.acs.org/doi/10.1021/ci060132x     </span>
<span class="sd">        </span>
<span class="sd">    k : int</span>
<span class="sd">        Number of k nearest neighbours</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    </span>
<span class="sd">    avg_distance : float</span>
<span class="sd">        Average distance between query and k-nearest neighbours in AD.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ditances</span><span class="p">,</span> <span class="n">neighbours</span> <span class="o">=</span> <span class="n">get_knn</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">ref_fp</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">avg_distance</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">neighbours</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">avg_distance</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">mols2grid</span><span class="o">.</span><span class="n">MolGrid</span><span class="p">(</span><span class="n">trainset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">neighbours</span><span class="p">],</span> <span class="n">smiles_col</span><span class="o">=</span><span class="s2">&quot;processed_smiles&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Hs-HEPG2&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span><span class="s2">&quot;img&quot;</span><span class="p">],</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-23-11191bce9c71&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># setup the grid</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>grid <span class="ansi-blue-fg">=</span> mols2grid<span class="ansi-blue-fg">.</span>MolGrid<span class="ansi-blue-fg">(</span>trainset<span class="ansi-blue-fg">.</span>iloc<span class="ansi-blue-fg">[</span>neighbours<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> smiles_col<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;processed_smiles&#34;</span><span class="ansi-blue-fg">,</span> size<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">200</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">180</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Hs-HEPG2&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> grid<span class="ansi-blue-fg">.</span>display<span class="ansi-blue-fg">(</span>subset<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;ID&#34;</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#34;img&#34;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> n_cols<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">,</span> n_rows<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;neighbours&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Refactor">Refactor<a class="anchor-link" href="#Refactor"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="kNNDomain" class="doc_header"><code>class</code> <code>kNNDomain</code><a href="https://github.com/marcossantanaioc/qsar_ad/tree/master/qsar_ad/applicability_domain.py#L13" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>kNNDomain</code>(<strong><code>Xref</code></strong>:<code>array</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ad_knn</span> <span class="o">=</span> <span class="n">kNNDomain</span><span class="p">(</span><span class="n">Xref</span><span class="o">=</span><span class="n">Xtrain</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ad_knn</span><span class="o">.</span><span class="n">ad_threshold</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>9.958452035589074</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">avg_distance</span> <span class="o">=</span> <span class="n">ad_knn</span><span class="o">.</span><span class="n">calculate_applicability_domain</span><span class="p">(</span><span class="n">X_sample</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">avg_distance</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(7.11829279911435, True)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

